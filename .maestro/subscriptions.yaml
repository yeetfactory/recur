appId: com.yeetfactory.recur
---
# ═══════════════════════════════════════════════════════
# Phase 1: Create a subscription with emoji, list, amount
# ═══════════════════════════════════════════════════════

- assertVisible:
    id: "add-subscription-open"
- tapOn:
    id: "add-subscription-open"
- extendedWaitUntil:
    visible:
      id: "add-subscription-name-input"
    timeout: 10000

# ─── Pick an emoji icon ───
- tapOn:
    id: "add-subscription-avatar"
- extendedWaitUntil:
    visible:
      id: "emoji-picker-done"
    timeout: 10000
- tapOn:
    id: "emoji-option-entertainment-0"

# ─── Enter name ───
- extendedWaitUntil:
    visible:
      id: "add-subscription-name-input"
    timeout: 10000
- tapOn:
    id: "add-subscription-name-input"
- inputText: "Spotify"

# ─── Select the Essentials list ───
- tapOn:
    id: "add-subscription-list-essentials"

# ─── Enter amount ───
- tapOn:
    id: "add-subscription-amount-input"
- inputText: "12"

# ─── Save subscription ───
- tapOn:
    id: "add-subscription-save"
- runFlow:
    when:
      visible:
        id: "add-subscription-save"
    commands:
      - tapOn:
          id: "add-subscription-save"

# ─── Verify subscription appears on dashboard ───
- extendedWaitUntil:
    visible: "Spotify"
    timeout: 15000
- assertVisible: "₹12.00"
- assertVisible:
    id: "subscription-spotify-card"

# ═══════════════════════════════════════════════════════
# Phase 2: Verify view mode toggle (monthly → yearly → monthly)
# ═══════════════════════════════════════════════════════

- tapOn:
    id: "view-mode-yearly"
- extendedWaitUntil:
    visible: "₹144.00"
    timeout: 5000
- assertVisible: "₹144.00"

- tapOn:
    id: "view-mode-monthly"
- extendedWaitUntil:
    visible: "₹12.00"
    timeout: 5000
- assertVisible: "₹12.00"

# ═══════════════════════════════════════════════════════
# Phase 3: Verify filter chips work
# ═══════════════════════════════════════════════════════

# ─── Filter to "Essentials" list ───
- tapOn:
    id: "filter-chip-essentials"
- assertVisible: "Spotify"

# ─── Filter to "Fun" list (empty) – Spotify should not be visible ───
- tapOn:
    id: "filter-chip-fun"
- assertVisible: "No subscriptions in this list."
- assertNotVisible:
    id: "subscription-spotify-card"

# ─── Back to "All" ───
- tapOn:
    id: "filter-chip-all"
- assertVisible: "Spotify"

# ═══════════════════════════════════════════════════════
# Phase 4: Edit subscription – navigate to manage lists from edit
# ═══════════════════════════════════════════════════════

- tapOn:
    id: "subscription-spotify-edit"
- extendedWaitUntil:
    visible:
      id: "edit-subscription-name-input"
    timeout: 10000
- assertVisible:
    id: "edit-subscription-manage-lists"
- tapOn:
    id: "edit-subscription-manage-lists"
- extendedWaitUntil:
    visible:
      id: "manage-lists-add-new"
    timeout: 10000
- assertVisible:
    id: "manage-lists-add-new"
- back
- tapOn:
    id: "tab-home"

# ═══════════════════════════════════════════════════════
# Phase 5: Edit subscription – change frequency, amount, date
# ═══════════════════════════════════════════════════════

- extendedWaitUntil:
    visible:
      id: "subscription-spotify-edit"
    timeout: 10000
- tapOn:
    id: "subscription-spotify-edit"
- extendedWaitUntil:
    visible:
      id: "edit-subscription-name-input"
    timeout: 10000

# ─── Change frequency to yearly ───
- tapOn:
    id: "edit-subscription-frequency-yearly"

# ─── Change amount to 180 ───
- tapOn:
    id: "edit-subscription-amount-input"
- eraseText: 20
- inputText: "180"

# ─── Change date ───
- tapOn:
    id: "edit-subscription-date-input"
- eraseText: 20
- inputText: "2025-01-01"

# ─── Update ───
- tapOn:
    id: "edit-subscription-update"
- runFlow:
    when:
      visible:
        id: "edit-subscription-update"
    commands:
      - tapOn:
          id: "edit-subscription-update"

# ─── Verify monthly view: 180/12 = ₹15.00 ───
- extendedWaitUntil:
    visible: "₹15.00"
    timeout: 10000
- assertVisible: "₹15.00"

# ─── Verify yearly view ───
- tapOn:
    id: "view-mode-yearly"
- extendedWaitUntil:
    visible: "₹180.00"
    timeout: 5000
- assertVisible: "₹180.00"

# ─── Switch back to monthly ───
- tapOn:
    id: "view-mode-monthly"
- extendedWaitUntil:
    visible: "₹15.00"
    timeout: 5000
- assertVisible: "₹15.00"

# ═══════════════════════════════════════════════════════
# Phase 6: Add a second subscription to test totals
# ═══════════════════════════════════════════════════════

- tapOn:
    id: "add-subscription-open"
- extendedWaitUntil:
    visible:
      id: "add-subscription-name-input"
    timeout: 10000
- tapOn:
    id: "add-subscription-name-input"
- inputText: "Netflix"
- tapOn:
    id: "add-subscription-list-fun"
- tapOn:
    id: "add-subscription-amount-input"
- inputText: "15"
- tapOn:
    id: "add-subscription-save"
- runFlow:
    when:
      visible:
        id: "add-subscription-save"
    commands:
      - tapOn:
          id: "add-subscription-save"

# ─── Verify both subscriptions are visible ───
- extendedWaitUntil:
    visible: "Netflix"
    timeout: 15000
- assertVisible: "Spotify"
- assertVisible: "Netflix"

# ─── Verify total = ₹15 + ₹15 = ₹30.00 monthly ───
- assertVisible: "₹30.00"

# ─── Filter to Essentials – only Spotify ───
- tapOn:
    id: "filter-chip-essentials"
- assertVisible: "Spotify"
- assertNotVisible:
    id: "subscription-netflix-card"

# ─── Filter to Fun – only Netflix ───
- tapOn:
    id: "filter-chip-fun"
- assertVisible: "Netflix"
- assertNotVisible:
    id: "subscription-spotify-card"

# ─── Back to All ───
- tapOn:
    id: "filter-chip-all"
- assertVisible: "Spotify"
- assertVisible: "Netflix"

# ═══════════════════════════════════════════════════════
# Phase 7: Cancel the edit dialog (no changes should persist)
# ═══════════════════════════════════════════════════════

- tapOn:
    id: "subscription-netflix-edit"
- extendedWaitUntil:
    visible:
      id: "edit-subscription-name-input"
    timeout: 10000
- tapOn:
    id: "edit-subscription-cancel"
- extendedWaitUntil:
    visible: "Netflix"
    timeout: 10000
- assertVisible: "₹15.00"

# ═══════════════════════════════════════════════════════
# Phase 8: Delete the second subscription (Netflix)
# ═══════════════════════════════════════════════════════

- tapOn:
    id: "subscription-netflix-delete"
- extendedWaitUntil:
    visible:
      id: "subscription-delete-confirm"
    timeout: 10000
- tapOn:
    id: "subscription-delete-confirm"
- extendedWaitUntil:
    visible: "₹15.00"
    timeout: 10000
- assertNotVisible: "Netflix"
- assertVisible: "Spotify"
